import { pReduce } from '@reskript/core';
const normalize = (plugin) => {
    if (!plugin) {
        return [];
    }
    if (Array.isArray(plugin)) {
        return plugin.flatMap(normalize);
    }
    return [plugin];
};
export const applyPlugins = async (settings, plugins, cmd) => {
    const pluginsToApply = typeof plugins === 'function' ? plugins(cmd.commandName) : plugins;
    const applied = await pReduce(pluginsToApply.flatMap(normalize), (baseSettings, apply) => Promise.resolve(apply(baseSettings, cmd)), settings);
    return applied;
};
